<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scrollytelling Portrait - Final</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { height: 100%; overflow-x: hidden; background: black; }
    
    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    canvas {
      display: block;
      width: auto;
      height: 100vh;
      aspect-ratio: 9/16;
    }

    /* Scroll space untuk trigger scroll */
    #scroll-space {
      width: 0;
    }
  </style>
</head>
<body>

<canvas id="canvas"></canvas>
<div id="scroll-space"></div>

<script>
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  const frameCount = 16; // ganti sesuai jumlah frame
  const images = [];
  let ready = false;

  // Path folder scrollytelling
  const framePath = i => `/scrollytelling/frames/frame_${String(i).padStart(6,"0")}.webp`;

  // Set canvas size
  canvas.width = 720;
  canvas.height = 1280;

  // Preload images
  let loaded = 0;
  for(let i=0; i<frameCount; i++){
    const img = new Image();
    img.src = framePath(i);
    img.onload = () => {
      loaded++;
      if(loaded === 1){
        ready = true;
        drawFrame(0);
      }
    };
    img.onerror = () => console.error("Gagal load:", img.src);
    images.push(img);
  }

  function drawFrame(i){
    if(!images[i]) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(images[i],0,0,canvas.width,canvas.height);
  }

  // Automatic scroll-space height based on frame count
  const scrollSpace = document.getElementById("scroll-space");
  scrollSpace.style.height = `${frameCount * 100}vh`; // 1 layar per frame

  // Scroll listener
  window.addEventListener("scroll", ()=>{
    if(!ready) return;

    const scrollTop = window.scrollY;
    const pixelsPerFrame = window.innerHeight; // 1 layar = 1 frame
    const index = Math.min(frameCount-1, Math.floor(scrollTop / pixelsPerFrame));

    drawFrame(index);
  });

  // Optional: responsive canvas
  function resizeCanvas(){
    const h = window.innerHeight;
    const w = h * 9 /16;
    canvas.style.width = w + "px";
    canvas.style.height = h + "px";
  }
  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();
</script>

</body>
</html>
