<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scrollytelling Addakwa</title>
  <style>
    /* Reset dasar */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background-color: #000;
      /* HEIGHT adalah kunci kecepatan scroll. 
         Semakin tinggi vh, semakin lambat animasinya.
         Coba ganti 400vh ke 600vh jika ingin lebih pelan.
      */
      height: 400vh; 
      margin: 0;
    }

    /* Wadah canvas agar selalu di tengah */
    .canvas-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1; /* Pastikan di bawah konten lain jika ada */
    }

    canvas {
      display: block;
      /* Agar responsif tapi tetap menjaga rasio */
      max-width: 100%;
      max-height: 100vh;
      object-fit: contain; 
    }

    /* Loading text (optional) */
    #loader {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-family: sans-serif;
      z-index: 10;
      pointer-events: none;
    }
  </style>
</head>
<body>

  <div id="loader">Loading 0%...</div>

  <div class="canvas-container">
    <canvas id="hero-scrolly"></canvas>
  </div>

  <script>
    const canvas = document.getElementById("hero-scrolly");
    const context = canvas.getContext("2d");
    const loader = document.getElementById("loader");

    // KONFIGURASI
    const frameCount = 16; // Total gambar (0 s/d 15)
    
    // Fungsi untuk generate URL gambar
    const currentFrame = index => (
      `https://www.addakwa.com/scrollytelling/frames/frame_${index.toString().padStart(6, '0')}.webp`
    );

    const images = [];
    const scrollState = { frame: 0 };

    // Set ukuran internal canvas (Resolusi HD Vertikal / 9:16)
    canvas.width = 720;
    canvas.height = 1280;

    // 1. PRELOAD IMAGES
    // Kita harus load semua gambar dulu agar transisi mulus
    let imagesLoaded = 0;

    const preloadImages = () => {
      for (let i = 0; i < frameCount; i++) {
        const img = new Image();
        img.src = currentFrame(i);
        
        img.onload = () => {
          imagesLoaded++;
          // Update text loading
          const percent = Math.round((imagesLoaded / frameCount) * 100);
          loader.innerText = `Loading ${percent}%...`;

          // Jika semua sudah load
          if (imagesLoaded === frameCount) {
            loader.style.opacity = 0; // Sembunyikan loader
            render(); // Gambar frame pertama
          }
        };

        img.onerror = () => {
          console.error(`Gagal load gambar index: ${i}`);
        };

        images.push(img);
      }
    };

    // 2. FUNGSI GAMBAR KE CANVAS
    const render = () => {
      // Pastikan gambar sudah ada di array sebelum digambar
      if (images[scrollState.frame]) {
        context.clearRect(0, 0, canvas.width, canvas.height);
        context.drawImage(images[scrollState.frame], 0, 0);
      }
    };

    // 3. LOGIKA SCROLL
    window.addEventListener('scroll', () => {
      const scrollTop = document.documentElement.scrollTop;
      const maxScrollTop = document.documentElement.scrollHeight - window.innerHeight;
      
      // Berapa persen user sudah scroll ke bawah? (0.0 s/d 1.0)
      const scrollFraction = scrollTop / maxScrollTop;

      // Konversi persen scroll ke index frame
      // Math.min memastikan tidak melebihi frameCount - 1
      const frameIndex = Math.min(
        frameCount - 1,
        Math.ceil(scrollFraction * frameCount)
      );

      // Hanya render ulang jika frame berubah (performance optimization)
      if (frameIndex !== scrollState.frame) {
        scrollState.frame = frameIndex;
        requestAnimationFrame(render);
      }
    });

    // Jalankan preload
    preloadImages();

  </script>
</body>
</html>